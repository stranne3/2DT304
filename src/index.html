<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" name="viewport" content="width=device-width">
    <title>Crowding in exercise tracks</title>
    <link type="text/css" href="css/index.css" rel="stylesheet">
  </head>
  <body>
    <header class="top_header">
      <div class="header_nav">
          <form action="/charts" method="get">
            <button id="chartButton" type="submit" title="charts"></button>
          </form>
        </div>
    </header>
    <h3>Motionsspår</h3>

    <button id="sendLocation" onclick="postForm()">Klicka här</button>
    <p id="userInfo"></p>
  </body>
  <script type="text/javascript">
    var c = {};
    async function postForm() {
      getLoc()
    }

    async function getLoc() {
      if(!navigator.geolocation) {
        alert("Geolocation is not supported by your browser.")
      } else {
          navigator.geolocation.getCurrentPosition(await showPos, error)
        }
    }

    function error() {
      alert("Unable to retreive your location.")
    }

    async function showPos(position) {
      var form = document.createElement("form");
        form.setAttribute("method", "POST");
        //form.setAttribute("action", "/")
        form.setAttribute("hidden", true)
        
        var lat = document.createElement("input");
        lat.setAttribute("type", "text")
        lat.setAttribute("name", "lat")
        lat.setAttribute("value", position.coords.latitude)
        form.appendChild(lat)

        var long = document.createElement("input");
        long.setAttribute("type", "text")
        long.setAttribute("name", "long")
        long.setAttribute("value", position.coords.longitude)

        form.appendChild(long)
        var time = document.createElement("input");
        time.setAttribute("type", "text")
        time.setAttribute("name", "time")
        time.setAttribute("value", position.timestamp)

        form.appendChild(time)
        document.body.appendChild(form)
        form.submit();
        alert("Succesfully submitted your location!")
    }
  </script>
  
</html>
